<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{url_for('static', filename='css/styles.css')}}">
</head>
<body>
    <form id='parameters' method="GET" action="{{ url_for('data', artistRange='', artistLimit='', songRange='', songLimit='') }}">
        <label for="artistDuration">Artists Duration</label>
        <br>
        <select name="artistDuration" id="artistRange">
            <option value="short_term">Last 4 Weeks</option>
            <option value="medium_term">Last 6 Months</option>
            <option value="long_term">All Time</option>
        </select>
        <br>
        <label for="artistAmount">Artist Limit (Up to 50): </label>
        <input type="number" id="artistAmount" name="artistAmount">
        <br>
        <select name="songDuration" id="songRange">
            <option value="short_term">Last 4 Weeks</option>
            <option value="medium_term">Last 6 Months</option>
            <option value="long_term">All Time</option>
        </select>
        <br>
        <label for="songAmount">Song Limit (Up to 50): </label>
        <input type="number" id="songAmount" name="songAmount">
        <br>
        <button type="submit">Update</button>
    </form>
    <a href="{{url_for('sign_out')}}">Sign Out</a>

    <div id="artists">
    <h1>Top Artists</h1>
    {% if artists %}
        <ol>
            {% for artist in artists %}
                <li>
                    <strong>{{ artist.name }}</strong><br>
                    {% if artist.image_url %}
                        <img src="{{ artist.image_url }}" alt="{{ artist.name }}" width="100" height="100">
                    {% else %}
                        No Image Available
                    {% endif %}
                </li>
            {% endfor %}
        </ol>
    {% else %}
        <p>No top artists found.</p>
    {% endif %}
    </div>

    <div id="songs">
        <h1>Top Songs</h1>
    {% if songs %}
    <ol>
        {% for song in songs %}
            <li>
                <a href="{{song.link}}""><strong>{{ song.name }} - {{song.artist}}</strong></a><br>
                {% if song.cover %}
                    <img src="{{ song.cover }}" alt="{{ song.name }}" width="100" height="100">
                {% else %}
                    No Image Available
                {% endif %}
            </li>
        {% endfor %}
    </ol>
    {% else %}
        <p>No Songs Found.</p>
    {% endif %}
    </div>

    <script>
        var defaultUrl = `{{ url_for('data') }}?artistRange=medium_term&artistLimit=10&songRange=medium_term&songLimit=10`;
        history.replaceState({}, document.title, defaultUrl)



        $(document).ready(function() {

            var urlParams = new URLSearchParams(window.location.search);

            // Set the current values as placeholders in the form fields
            $("#artistRange").val(urlParams.get("artistRange") || 'medium_term');
            $("#artistAmount").attr("placeholder", urlParams.get("artistLimit") || '10');
            $("#songRange").val(urlParams.get("songRange") || 'medium_term');
            $("#songAmount").attr("placeholder", urlParams.get("songLimit") || '10');

            $("#parameters").submit(function(event) {
                event.preventDefault();
                var artistRange = $("#artistRange").val() || 'medium_term';
                var artistLimit = $("#artistAmount").val() || 10;
                var songRange = $("#songRange").val() || 'medium_term';
                var songLimit = $("#songAmount").val() || 10;

                // Construct the URL with query parameters using template literals
                var url = `{{ url_for('data') }}?artistRange=${artistRange}&artistLimit=${artistLimit}&songRange=${songRange}&songLimit=${songLimit}`;

                // Navigate to the constructed URL
                window.location.href = url;
            });
        });

    </script>
</body>
</html>
